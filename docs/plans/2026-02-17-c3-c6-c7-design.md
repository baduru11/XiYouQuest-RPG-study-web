# C3 Replacement + C6/C7 New Question Types

## Summary

Replace AI-generated C3 questions with 90 real exam questions (variable option counts), add C6 (Cantonese Mistakes pronunciation drills) and C7 (Polyphonic Characters MCQ) as supplementary practice components.

## C3: Replace Questions

### Database
- Delete all existing `component = 3` rows
- Insert 90 new questions from `doc/ExampleQuestions/C3.txt`:
  - 30 word-choice (set_number 1-30): 3-4 options each, pick standard Putonghua
  - 30 measure-word (set_number 1001-1030): 5 options (A-E), fill-in classifier
  - 30 sentence-order (set_number 2001-2030): 3 options, pick correct grammar

### Quiz Session Changes
- `QUIZ_SIZES`: 5 word-choice, 5 measure-word, 5 sentence-order (15 total per session)
- Word-choice layout: single horizontal row of options
- Measure-word grid: handles 5 options (was 4)
- Sentence-order: unchanged single-column

### No Other C3 Changes
- Page component, AI feedback, progress tracking all remain the same

## C6: Common Cantonese Mistakes (易错字词练习)

### Concept
Pronunciation drills for high-frequency trouble sounds. Three sequential sections per session, each showing words in groups of 5 for recording + ISE scoring.

### Categories
1. **平翘舌音** (z/c/s vs zh/ch/sh): 40 words (set_number 1-40)
2. **前后鼻音** (n vs ng): 40 words (set_number 101-140)
3. **边鼻音** (l vs n): 40 words (set_number 201-240)

Tongue twisters (items 41-45 in 平翘舌音) excluded for now.

### Session Flow
- 2 groups of 5 per category = 6 groups, 30 words total
- Sequential: 平翘舌音 → 前后鼻音 → 边鼻音
- Section label displayed at category transitions
- Each group: display words → optional TTS playback → record → iFlytek ISE assess (`read_word`) → AI feedback → next group

### Database
- 120 rows in `question_banks`, `component = 6`
- `content` = the word, `pinyin` = null
- `metadata` = `{"category": "zhcs" | "nng" | "ln"}`

### Implementation
- Route: `src/app/(main)/component-6/` (page.tsx, practice-session.tsx, loading.tsx)
- Follows C1/C2 PracticeSession pattern exactly
- Reuses AudioRecorder, CharacterDisplay, DialogueBox, all existing API routes
- Added section header between category transitions

## C7: Polyphonic Characters (多音字练习)

### Concept
MCQ practice for characters that change pronunciation by context. User sees a sentence with one highlighted character and picks the correct pinyin.

### Session Flow
- 15 questions per session, shuffled from pool of 50
- Reuses QuizSession component with new `"polyphonic"` question type
- Sentence rendered with `**X**` parsed into highlighted styling (bold + primary color)
- Options are pinyin strings (2-3 per question), rendered in single row

### Database
- 50 rows in `question_banks`, `component = 7`
- `content` = full sentence with `**X**` markers around target character
- `metadata` = `{"type": "polyphonic", "options": ["cháng", "zhǎng"], "correctIndex": 0, "highlightChar": "长"}`

### Implementation
- Route: `src/app/(main)/component-7/` (page.tsx, loading.tsx)
- Reuses QuizSession from component-3 (shared or extracted)
- New type badge: "多音字" / "Polyphonic Character"

## Navigation

### Dashboard Hub
New tiles for C6 and C7 in the hub menu.

### Practice Quest Board (`/practice`)
- Main section: C1-C5 component cards (unchanged)
- New "Supplementary Drills" section below with C6 and C7 cards

### Mock Exam
Unchanged — C6/C7 are not part of the official PSC format.

## Cross-Cutting Changes

### Database Migration
1. Alter `question_banks` CHECK constraint: `component BETWEEN 1 AND 5` → `BETWEEN 1 AND 7`
2. Delete all `component = 3` rows
3. Insert 90 C3 questions
4. Insert 120 C6 words
5. Insert 50 C7 questions

### Type Definitions
- `database.ts`: `QuestionBank.component` → `1 | 2 | 3 | 4 | 5 | 6 | 7`
- `practice.ts`: `QuizQuestion.type` adds `"polyphonic"`, component type widens
- All props interfaces accepting component numbers widen to include 6 and 7

### Constants
- `QUIZ_SIZES`: `{ WORD_CHOICE: 5, MEASURE_WORD: 5, SENTENCE_ORDER: 5, POLYPHONIC: 15 }`
- New `C6_GROUPS_PER_CATEGORY: 2`

### Files Changed
1. `src/types/database.ts` — component type
2. `src/types/practice.ts` — QuizQuestion type, component type
3. `src/lib/constants.ts` — quiz sizes, C6 config
4. `src/app/(main)/component-3/page.tsx` — quiz size references
5. `src/app/(main)/component-3/quiz-session.tsx` — word-choice single row, 5-option measure-word grid, polyphonic type support
6. `src/app/(main)/component-6/page.tsx` — new (server component)
7. `src/app/(main)/component-6/practice-session.tsx` — new (client component)
8. `src/app/(main)/component-6/loading.tsx` — new (skeleton)
9. `src/app/(main)/component-7/page.tsx` — new (server component)
10. `src/app/(main)/component-7/loading.tsx` — new (skeleton)
11. `src/app/(main)/dashboard/page.tsx` — add C6/C7 tiles
12. `src/app/(main)/practice/page.tsx` — add supplementary drills section
13. `src/components/shared/navbar.tsx` — no changes needed
14. Supabase migration — constraint + data

### No Changes Needed
- API routes (speech/assess, tts/speak, ai/feedback, progress/update)
- Auth flow, middleware, (main)/layout.tsx
- Mock exam, leaderboard, characters, profile, social
- AudioRecorder component
- Character system
